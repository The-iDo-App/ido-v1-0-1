if (self.CavalryLogger) { CavalryLogger.start_js(["ruWPPNl"]); }

__d("goURIOnWindow",["ConstUriUtils","FBLogger","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=typeof b==="string"?d("ConstUriUtils").getUri(b):b;if(e)a.location=e.toString();else{a="Invalid URI "+b.toString()+" provided to goURIOnWindow";c("FBLogger")("comet_infra").blameToPreviousFrame().mustfix(a)}}g["default"]=a}),98);
__d("RTWebCallWindowInitializer",["ConstUriUtils","ZenonForceP2PUsingMWPP","ZenonUserActionLogger","goURIOnWindow","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){this.$1=b}var e=a.prototype;e.initCall=function(a,e){var f,g,h,i,j,k,l,m,n,o,p,q,r;return b("regeneratorRuntime").async(function(s){while(1)switch(s.prev=s.next){case 0:g=e.context,h=e.joinContext,i=e.mediaType,j=e.nonce;k={alohaEscalatedMW:!1};if(a){s.next=4;break}return s.abrupt("return",k);case 4:m=null;g.intent==="accept invite"?(p=g.controllerParams,m=p.callContext,n={controllerParams:p},l=p.callID,o=[]):(l=g.callID,g.existingCall?n={existingCall:g.existingCall}:n=null,o=g.invitees);q=function(a){d("ZenonUserActionLogger").logEvent({call_id:l,call_type:h.type==="thread"&&h.thread.type===1&&!c("ZenonForceP2PUsingMWPP")(i)?"p2p":"mw",checkpoint:a,conference_name:(a=m)!=null?a:null,event:"checkpoint",is_caller:o.length>0,media_type:i})};if(!(h.type==="link")){s.next=11;break}s.t0=d("ConstUriUtils").getUri(h.linkUrl);s.next=14;break;case 11:s.next=13;return b("regeneratorRuntime").awrap(this.$1.getCallUri({callID:l,context:n,invitees:o,mediaType:i,nonce:j,thread:h.thread}));case 13:s.t0=s.sent;case 14:s.t1=f=s.t0;if(!(s.t1!=null)){s.next=19;break}s.t2=f;s.next=20;break;case 19:s.t2=null;case 20:r=s.t2;if(!(r===null)){s.next=24;break}q("Failed to determine call URL");return s.abrupt("return",k);case 24:q(r.toString());q("load_popup");h.type==="thread"&&h.thread.type===1&&!c("ZenonForceP2PUsingMWPP")(i)&&(r.getPath().includes("/groupcall/")&&(q("fetched_mw_url_for_aloha_interop"),k.alohaEscalatedMW=!0));this.__navigateToCallUri(r.toString(),a);return s.abrupt("return",k);case 29:case"end":return s.stop()}},null,this)};e.__navigateToCallUri=function(a,b){c("goURIOnWindow")(b,a),b.focus()};return a}();g["default"]=a}),98);
__d("isFacebookishURI",["isFacebookURI","isMessengerDotComURI"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("isFacebookURI")(a)||c("isMessengerDotComURI")(a)}g["default"]=a}),98);
__d("ZenonOfferStorage",["CacheStorage"],(function(a,b,c,d,e,f,g){"use strict";var h="localstorage",i="RTC_",j="offer",k="offer_msg";function l(a,b,c){c={__d:c,__t:Date.now()};a.set(b,c)}function m(a,b){return new(c("CacheStorage"))(h,""+i+a+"_"+b+"_")}function a(a,b){a=m(a,k);l(a,j,b)}g._storeData=l;g.getStorage=m;g.writePeerOfferToStorage=a}),98);
__d("ZenonP2PMessageDedup",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1={}}var b=a.prototype;b.isDuplicate=function(a){var b=a.call_id,c=a.from;a=a.id;this.$1[c]||(this.$1[c]={});this.$1[c][b]||(this.$1[c][b]={});if(this.$1[c][b][a])return!0;this.$1[c][b][a]=!0;return!1};return a}();f["default"]=a}),66);
__d("ZenonSignalingTransportTypes",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({CHILD_WINDOW_READY:"rtc_child_window_ready",PARENT_INITIATED_CALL:"rtc_child_window_start_call",PARENT_TO_CHILD_MESSAGE:"rtc_child_window_message"});f.ChildTransportMessageType=a}),66);
__d("ZenonSignalingParentTransport",["FBLogger","RTWebIncomingRingConfiguration","Random","URI","ZenonBrowsers","ZenonMWMessageTranslator","ZenonOfferStorage","ZenonP2PMessageDedup","ZenonP2PMessageTypes","ZenonSignalingProtocol","ZenonSignalingTransportTypes","gkx","isFacebookishURI","orEmptyArray","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h=10*60*1e3,i=45*1e3;a=function(){function a(){var a=this;this.verificationNonce=null;this.portToChild=null;this.$1=null;this.$2=null;this.$3=new Map();this.$4=new Map();this.$5=new Map();this.$6=new(c("ZenonP2PMessageDedup"))();this.$7=new Map();(d("RTWebIncomingRingConfiguration").isSupportedClientForProtocol(c("ZenonSignalingProtocol").P2P)||d("RTWebIncomingRingConfiguration").isSupportedClientForProtocol(c("ZenonSignalingProtocol").MW))&&window.addEventListener&&window.addEventListener("message",function(b){a.handleWindowMessageFromChild(b)},!1)}var b=a.prototype;b.handleWindowMessageFromChild=function(a){var b=this;if(this.windowMessageValid(a)&&a.data.type===d("ZenonSignalingTransportTypes").ChildTransportMessageType.CHILD_WINDOW_READY&&this.hasPort(a)){var c;c=(c=a.data.roomID)!=null?c:null;var e=a.data.serverInfoData;this.portToChild=a.ports[0];a=a.data;var f=a.childNonce;a=a.peerID;this.$2=f;window.clearTimeout(this.$1);this.$1=window.setTimeout(function(){b.portToChild=null},i);this.verificationNonce=this.generateNonce();this.startCallInChildWindow(c,e);this.$8(a)}};b.generateNonce=function(){return String(d("Random").random())};b.hasPort=function(a){return Boolean(a.ports!=null&&Array.isArray(a.ports)&&a.ports[0]!=null)};b.startCallInChildWindow=function(a,b){var c=null;if(b!==void 0){if(b!=null){c=j((b=this.$4.get(b))!=null?b:null)}}else if(a!=null){c=j((b=this.$3.get(a))!=null?b:null)}a={mwRingRequest:c,nonce:this.$2,offer:null,type:d("ZenonSignalingTransportTypes").ChildTransportMessageType.PARENT_INITIATED_CALL};this.sendMessageToChild(a)};b.windowMessageValid=function(a){return Boolean(a.origin===window.location.origin||c("isFacebookishURI")(new(c("URI"))(a.origin))&&c("isFacebookishURI")(new(c("URI"))(window.location.origin)))&&this.postMessageValid(a)};b.postMessageValid=function(a){return Boolean(this.verificationNonce!==null&&(a==null?void 0:(a=a.data)==null?void 0:a.nonce)===this.verificationNonce)};b.$8=function(a){var b=c("orEmptyArray")(this.$5.get(a)),d=Date.now();b=b.map(function(a){return a.time<=d-h?null:a.value}).filter(Boolean);for(var b=b,e=Array.isArray(b),f=0,b=e?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=b.length)break;g=b[f++]}else{f=b.next();if(f.done)break;g=f.value}g=g;this.sendSignalingMessageToChild(g)}this.$5["delete"](a)};b.sendSignalingMessageToChild=function(a){a={message:a,nonce:this.$2,type:d("ZenonSignalingTransportTypes").ChildTransportMessageType.PARENT_TO_CHILD_MESSAGE};this.sendMessageToChild(a)};b.sendMessageToChild=function(a){this.portToChild!=null?this.portToChild.postMessage(a):c("recoverableViolation")("The child window port should be available","rtc_www")};b.enqueueRawMWMessage=function(a){var b=a.jsonPayload,c=b.body;b=b.header;c=c.ringRequest;if(c){c=b.conferenceName;b=b.serverInfoData;this.$3.set(c,a);this.$4.set((c=b)!=null?c:null,a)}};b.enqueueRawP2PMessage=function(a){if(this.$6.isDuplicate(a))return;var b=String(a.from);if(a.msg_type===d("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.OFFER){this.$9(a);return}this.portToChild!=null&&this.sendSignalingMessageToChild(a);var c=this.$5.get(b);c||(c=[],this.$5.set(b,c));c.push({time:Date.now(),value:a})};b.testGetChildNonce=function(){return this.$2};b.storeOfferForBackwardsCompat=function(a,b){var e=this.$10(a,b);if(e===null){c("FBLogger")("rtc_www").mustfix("P2P callee child window opening with no offer in storage.",a,b);return}d("ZenonOfferStorage").writePeerOfferToStorage(a,e)};b.$10=function(a,b){a=a+","+b;return(b=this.$7.get(a))!=null?b:null};b.$9=function(a){var b=a.call_id,c=String(a.from);c=c+","+b;this.$7.set(c,a)};return a}();function j(a){var b;if(a===null)return null;var e=d("ZenonMWMessageTranslator").toSignalingMessage(a);e=e.getEvents().find(function(a){return a.eventName==="inviteRequest"});if((e==null?void 0:e.eventName)!=="inviteRequest")return null;b=(b=(b=e.roomInfo.context)==null?void 0:b.groupThreadID)!=null?b:null;e=(e=(e=e.roomInfo.context)==null?void 0:e.peerID)!=null?e:null;if(b!==null)return!d("ZenonBrowsers").onlySupportsUnifiedPlan()||c("gkx")("3976")?a:null;else if(e!==null)return k()?a:null;return null}function k(){return c("gkx")("3608")||c("gkx")("967")||c("gkx")("3976")}g["default"]=a}),98);
__d("RTWebMercuryCallWindowInitializer",["RTWebCallWindowInitializer","URI"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}var d=b.prototype;d.__navigateToCallUri=function(a,b){typeof b.location==="string"?b.location=a.toString():c("URI").goURIOnWindow(a.toString(),b,!0),b.focus()};return b}(c("RTWebCallWindowInitializer"));g["default"]=a}),98);
__d("XVideoCallController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videocall/incall/",{peer_id:{type:"FBID",required:!0},call_id:{type:"Int"},is_caller:{type:"Bool",defaultValue:!1},audio_only:{type:"Bool",defaultValue:!1},nonce:{type:"String"},meeting_id:{type:"Int"},meeting_pass:{type:"String"},initialize_video:{type:"Bool",defaultValue:!0},locale:{type:"String"}})}),null);