System.register(["./chunk-vendor.js","./chunk-frameworks.js"],(function(){"use strict";var t,e,s,r,a,i;return{setters:[function(i){t=i._,e=i.t,s=i.j,r=i.aj,a=i.c},function(t){i=t.s}],execute:function(){var o;const{getItem:l,setItem:n}=i("localStorage");let d=o=class FeatureCalloutElement extends HTMLElement{constructor(){super(...arguments),this.dismissEvent="click",this.labelClass="new-feature-label"}async connectedCallback(){this.bootstrapFromLocalStorage()||await this.bootstrapFromServer()}bootstrapFromLocalStorage(){const t=l(this.localStorageKey);return!!t&&(this.bootstrap(JSON.parse(t)),!0)}get localStorageKey(){return`${o.LocalStoragePrefix}:${this.featureName}`}async bootstrapFromServer(){try{const t=await fetch(this.queryPath,{method:"GET",headers:o.FetchHeaders}),e=await t.text();if(!t.ok)throw new Error(`unexpected response status ${t.status}: '${e}'`);const s=JSON.parse(e);return this.bootstrap(s),s.dismissed&&n(this.localStorageKey,e),!0}catch(t){throw new Error(`failed to get feature state from server: ${t}`)}return!1}bootstrap(t){if(!("dismissed"in t)||null===t.dismissed)throw new Error(`malformed response, likely no notice configured: '${JSON.stringify(t)}'`);t.dismissed||(this.applyTargetDefaults(),this.showCallout(),this.dismisser.addEventListener(this.dismissEvent,this.handleDismissal.bind(this),{once:!0}),this.detectAndBindToTabContainer())}detectAndBindToTabContainer(){const t=this.querySelector("tab-container");t&&t.addEventListener("tab-container-changed",(t=>{const e=t;e.detail&&e.detail.relatedTarget&&e.detail.relatedTarget.getAttribute("aria-labelledby")===this.dismisser.id&&this.handleDismissal()}))}applyTargetDefaults(){if(!this.firstElementChild||this.labelee&&this.dismisser)return;let t=this.firstElementChild.getAttribute("data-target")||"";this.labelee||(t=t.concat(" feature-callout.labelee")),this.dismisser||(t=t.concat(" feature-callout.dismisser")),this.firstElementChild.setAttribute("data-target",t)}handleDismissal(){this.submitForm(),n(this.localStorageKey,'{"dismissed":true}')}showCallout(){this.labelee.classList.add(this.labelClass)}async submitForm(){const t=this.dismissalForm;if(t)try{const e=await fetch(t.action,{method:t.method,body:new FormData(t),headers:o.FetchHeaders});if(!e.ok)throw new Error(`unexpected response status ${e.status}: ${await e.text()}`)}catch(e){throw new Error(`failed to persist dismissal to server: ${e}`)}}};d.LocalStoragePrefix="feature-callout",d.FetchHeaders={"X-Requested-With":"XMLHttpRequest"},t([e],d.prototype,"labelee",void 0),t([e],d.prototype,"dismisser",void 0),t([e],d.prototype,"dismissalForm",void 0),t([s],d.prototype,"queryPath",void 0),t([s],d.prototype,"featureName",void 0),t([s],d.prototype,"dismissEvent",void 0),t([s],d.prototype,"labelClass",void 0),t([r(1,{once:!0})],d.prototype,"handleDismissal",null),d=o=t([a],d)}}}));
//# sourceMappingURL=chunk-feature-callout-element-80cd4c8a.js.map
